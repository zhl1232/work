# 下一步计划与路线图

## 🚀 未来功能

### 社交互动

- [x] **用户关注系统**：允许用户关注创作者并在动态流中查看他们的更新（已在移动端实现）。
- [x] **私信系统**：用户之间用于协作的简单消息系统。

### 游戏化

- [x] **动态徽章体系 (Dynamic Badges)**
  - **设计目标**: 打造具有收藏价值和成就感的成长体系。
  - **视觉风格推荐**: **3D / 玻璃拟态 (Glassmorphism)**。相比扁平化，3D 质感配合动态光效能带来更强的“获得感”和“高级感”，符合 Wow 的设计原则。
  - **现状**: 项目已定义 **112 个徽章** (`lib/gamification/badges.ts`)，其中 **102 个** 为阶梯式可升级设计，**15 个** 为单档或手动授予。当前各系列档位数量不统一（5～11 档），与 铜/银/金/白金 四档设计不匹配。
  - **徽章总览**:

    **阶梯式可升级（规划收敛为 铜/银/金/白金 四档）**

    | 系列 | 度量 | 铜 | 银 | 金 | 白金 |
    |------|------|-----|-----|-----|------|
    | 🎯 入门·点赞 | 累计点赞数 | 1 | 10 | 50 | 200 |
    | 🎯 入门·评论 | 累计评论数 | 1 | 10 | 50 | 200 |
    | 🎯 入门·发布 | 累计发布数 | 1 | 5 | 10 | 30 |
    | 🎯 入门·收藏 | 累计收藏数 | 1 | 10 | 50 | 200 |
    | 🔬 科学专家 | 科学类完成数 | 5 | 20 | 50 | 100 |
    | 💻 技术达人 | 技术类完成数 | 5 | 20 | 50 | 100 |
    | ⚙️ 工程师 | 工程类完成数 | 5 | 20 | 50 | 100 |
    | 🎨 艺术家 | 艺术类完成数 | 5 | 20 | 50 | 100 |
    | 🔢 数学家 | 数学类完成数 | 5 | 20 | 50 | 100 |
    | 📝 创作者 | 发布项目数 | 1 | 5 | 10 | 50 |
    | 💬 社交达人 | 评论+回复总数 | 10 | 50 | 200 | 500 |
    | ❤️ 人气之星 | 收到赞数 | 10 | 100 | 500 | 2000 |
    | 🏆 成就里程碑 | 总完成数 | 5 | 25 | 100 | 500 |
    | 🌟 等级晋升 | 用户等级 | 5 | 25 | 50 | 100 |
    | 🎮 挑战赛 | 参加次数 | 3 | 10 | 50 | 100 |
    | 🔥 连续打卡 | 连续登录天数 | 3 | 7 | 30 | 90 |

    **单档 / 手动授予（保持现状）**

    | 系列 | 说明 |
    |------|------|
    | 👣 首步成就 | 注册、首次参与讨论等一次性成就 |
    | 💎 稀有限定 | 平台先驱、漏洞猎人、贡献者、测试先锋、周年纪念（后端手动授予） |

  - **后续优化**: ① 将现有多档位徽章收敛为 铜/银/金/白金 四档；② 入门系列扩展为阶梯式（点赞/评论/发布/收藏）；③ 稀有限定系列保持手动授予。
- [x] **排行榜筛选 (Leaderboard System)**
  - **多维度视图**: 支持 **本周 (Weekly)** / **本月 (Monthly)** / **总榜 (All-time)** 切换（积分榜 Tab 下）。
  - **技术方案**: 使用物化视图 `mv_leaderboard_weekly_xp` / `mv_leaderboard_monthly_xp` 缓存本周/本月 XP 聚合；RPC `get_leaderboard_xp_weekly` / `get_leaderboard_xp_monthly` 供前端调用。刷新：`SELECT refresh_leaderboard_mvs();`，建议每小时执行（如 pg_cron 或定时任务）。
  - **讨论结论（头像光环）**: 不做「仅在排行榜内可见」的前三头像光环——离开排行榜就消失，身份感与收藏价值弱。改为将 **头像光环/头像框** 纳入 **积分商店与成就体系**：用户兑换或解锁后装备，在个人页、评论、动态、排行榜等所有出现头像处统一展示（见下「积分商店」商品规划）。
- [x] **积分商店系统与双货币**
  - **设计结论**: 积分商店若直接消耗当前 XP，会与「等级 = f(当前 XP)」冲突（花 XP 会掉级）。采用 **双货币** 更清晰：
    - **XP（经验）**：只增不减，仅用于升级与等级，不参与消费、不参与投币。
    - **第二货币（如硬币/积分）**：可增可减，用于 **商店兑换** 与 **投币支持创作者**。
  - **硬币获取**（严格控制）: 仅 **每日登录/打卡** 发放 **2 硬币**，无其他获取渠道。与 XP 同源、同时发：在现有打卡逻辑的同一事务内写 `xp_logs` 并更新 `profiles.xp`，再写 `coin_logs`（`action_type = 'daily_login'`, `amount = 2`）并 `profiles.coins += 2`；防刷：同用户同日仅发一次。
  - **硬币花费**: ① **赞赏**：用户对创作者的某个作品打赏硬币，扣己方余额、加对方余额；**每个作品限 2 硬币**（该作品累计收到的打赏总额上限为 2）。② **商店**：兑换头像框/主题等。
  - **投币支持**: 项目页/个人页「投币支持」→ 扣自己余额、加对方余额；对方可用于继续投币或商店兑换。每个作品累计收到的打赏总额上限为 2 硬币。若未来做真实货币充值需单独考虑合规。
  - **商品规划**（用第二货币）:
    - 🖼️ **头像框 / 头像光环**: 霓虹光环、像素边框、节日限定框等。用户装备后在 **全站** 展示（个人页、评论、动态、排行榜等所有出现头像处），形成身份感与收藏价值。可选：成就/里程碑奖励（如「曾进入总榜前三」解锁限定光环）与商店兑换并行。
    - 🎨 **个人主页主题**: 解锁不同的背景色或纹理。
    - 📛 **昵称特效**: 聊天室或评论区的昵称颜色特效。

- [x] **连续打卡加成与每日小目标**
  - **现状**: 已有 **连续打卡统计**（`daily_check_in` RPC 更新连续/累计天数）和 **连续打卡徽章**（3/7/30/90 天）。
  - **已实现**: ① 打卡时根据连续天数发放 XP（基础 5 + 连签加成 min(连续天数, 20)，封顶 25）；② **每日小目标**：今日完成第 1 个项目 → 额外 +10 XP（`daily_goal_first_complete`）；③ **每周小目标**：评论/回复合计满 5 次 → 额外 +5 XP，当周仅一次（`weekly_goal_comments_5`）。均用 `xp_logs` 防重复。

- **游戏化扩展方向（讨论摘要）**
  - 排行榜多维度（本周/本月/总榜 + 物化视图）。头像光环/头像框纳入商店与成就体系（用户级、全站展示），不做仅排行榜内展示的前三光环。距离下一徽章/档位的进度提示。
  - 双货币 + 积分商店 + 投币支持（见上）。
  - 连续打卡 XP 加成、每日/每周小目标（见上）。
  - 可选：称号、徽章稀有度展示（全站 X% 拥有）、等级权益（如某级解锁高级筛选）、社区集体目标（如本周社区完成 1000 个项目达成奖励）。

### STEAM 游乐场 (STEAM Playground)

- [ ] **游乐场基础设施与经典游戏 (Phase 1)**
  - **定位**: 融合“游玩”与“学习”的互动空间。不仅提供游戏，更解析背后的 STEAM 原理。
  - **首发阵容**:
    - **扫雷 (Minesweeper)**：结合概率学、矩阵运算与逻辑推理。提供“1-2 定式”、“1-2-1 定式”等高级扫雷技巧教程，解析“洪水漫水算法 (Flood Fill)”。
    - **五子棋 (Gomoku)**：结合博弈论。展示基础的必胜阵型，并浅析 AI 对战背后的“极小极大算法 (Minimax)”与“评估函数”。
  - **功能要求**: 纯前端状态驱动（React Hooks），结合目前项目的 Glassmorphism UI，提供沉浸式体验；支持通关耗时/高分记录，并与成长体系（XP、徽章）挂钩。

- [ ] **硬核关卡与编程对抗 (Phase 2 & 3 远期)**
  - 加入代码对抗（AI Arena）：允许用户上传自己的算法（例如五子棋 AI），在虚拟竞技场与官方 AI 或其他用户的 AI 自动对战。
  - 引入更多品类：如编程解谜类（类似光效路由、指令方块）、元胞自动机（生命游戏）探索等。

## 🛠 技术债与改进

### 类型安全

- [x] **严格空值检查**：在 `tsconfig.json` 中启用 `strictNullChecks` 并修复产生的错误。
- [x] **Zod 验证**：使用 Zod 对 Supabase 响应和表单输入进行运行时验证。

### 测试

- [ ] **集成测试 (Integration Tests)**
  - **工具链**: 使用 **Playwright** 进行端到端 (E2E) 测试。
  - **策略**: 针对本地 Supabase 实例运行测试，覆盖核心路径 (注册 -> 创建项目 -> 评论互动)。
  - **数据模拟**: 编写 Seed 脚本，确保测试环境数据一致性。
- [x] **CI/CD 流水线 (Automation)**
  - **GitHub Actions**:
    - **PR Check**: 自动运行 `Type Check`, `Lint`, `Build` 检查。
    - **Preview**: 自动部署 Cloudflare Pages 预览环境 (针对每个 PR)。
    - **Release**:合并到 main 分支后自动打 Tag 并部署到 Cloudflare 生产环境。

### 性能与体验优化 (Performance & UX)

- [x] **加载性能缓存与骨架屏 (Suspense & Caching)**
  - 根据 React Server Components (RSC) 特性，全面审查数据获取层，通过 `<Suspense>` 提供骨架屏平滑加载 (优化 LCP 与 CLS)。
  - 对 `framer-motion`, `canvas-confetti` 以及富文本渲染器等重依赖利用 `next/dynamic` 实施路由或组件级懒加载。
- [x] **图片与多媒体加载优化**
  - 在 `next/config` 中全面检查 Cloudflare / Supabase Storage 的图片白名单配置。
  - 分离或接入 Cloudflare Images 等服务，确保用户上传的图片经过自动压缩，统一以 WebP/AVIF 等现代格式响应。
- [x] **离线化支持与状态管理 (TanStack Query v5)**
  - 深入结合使用的 TanStack Query V5 特性，配置更好的 `staleTime` 和 `gcTime`，在适当处引入乐观更新 (Optimistic Updates)。
  - 考虑添加 Web App Manifest 提供轻量级的 PWA/Service Worker 支持。

### 搜索引擎优化与分析 (SEO & Analytics)

- [x] **SEO 与 OpenGraph (动态 Meta tags)**
  - 为个人主页和项目详情页动态生成 Meta Tags 与 OpenGraph/Twitter 卡片标签，提升在外部社交群体的分享访问点击率。
  - 添加自动生成的 `sitemap.xml` 和 `robots.txt`，优化各大搜索引擎收录。

### 安全与生产环境稳定性 (Security & Stability)

- [x] **访问控制深度审计 (RLS & 鉴权)**
  - 对 Supabase 的 Row Level Security (RLS) 策略进行全面二次审计，确保零越权隐患（尤其是涉及用户金币和 XP 变动的核心业务表）。
- [x] **限流防刷 (Rate Limiting)**
  - 针对高频写入接口（如点赞、评论、打卡、投币业务），在系统边界（Cloudflare WAF 或 Next Proxy）增加限流过滤机制，防止脚本恶意刷量。